<sql>	
    <view>DROP VIEW IF EXISTS V_USUARIOS;</view>
	<view>
	    CREATE VIEW V_USUARIOS AS
	    SELECT DISTINCT
			U.*, 
			JB.ID as IDJEFSUP, JB.USUARIO as USUARIOJEFSUP, JB.CLAVE as CLAVEJEFSUP,  
			CD.ID as IDCOR, CD.USUARIO as USUARIOCOR, CD.CLAVE as CLAVECOR,  
			SN.ID as IDSUPNAC, SN.USUARIO as USUARIOSUPNAC, SN.CLAVE as CLAVESUPNAC
			FROM T_USUARIO U 
		      LEFT JOIN T_USUARIO SN ON SN.CARGO_ID = 3 AND SN.COD_SEDE_OPERATIVA='99' AND NOT U.ID=SN.ID
		      LEFT JOIN T_USUARIO CD ON CD.CARGO_ID = 3 AND CD.COD_SEDE_OPERATIVA=U.COD_SEDE_OPERATIVA AND CD.EQUIPO IS NULL AND NOT U.ID=CD.ID
		      LEFT JOIN T_USUARIO JB ON JB.CARGO_ID = 3 AND JB.COD_SEDE_OPERATIVA=U.COD_SEDE_OPERATIVA AND JB.EQUIPO=U.EQUIPO AND NOT U.ID=JB.ID
		      LEFT JOIN T_USUARIO AC ON AC.CARGO_ID = 1 AND AC.COD_SEDE_OPERATIVA=U.COD_SEDE_OPERATIVA AND AC.EQUIPO=U.EQUIPO AND AC.RUTA=U.RUTA AND NOT U.ID=AC.ID
		      LEFT JOIN T_USUARIO RG ON RG.CARGO_ID = 2 AND RG.COD_SEDE_OPERATIVA=U.COD_SEDE_OPERATIVA AND RG.EQUIPO=U.EQUIPO AND RG.RUTA=U.RUTA AND NOT U.ID=RG.ID
		      LEFT JOIN T_USUARIO AR ON AR.CARGO_ID = 5 AND AR.COD_SEDE_OPERATIVA=U.COD_SEDE_OPERATIVA AND AR.EQUIPO=U.EQUIPO AND AR.RUTA=U.RUTA AND NOT U.ID=AR.ID
		      LEFT JOIN T_USUARIO RT ON RT.CARGO_ID = 7 AND RT.COD_SEDE_OPERATIVA=U.COD_SEDE_OPERATIVA AND RT.EQUIPO=U.EQUIPO AND NOT U.ID=RT.ID
		      LEFT JOIN T_USUARIO CC ON CC.CARGO_ID = 8 AND CC.COD_SEDE_OPERATIVA=U.COD_SEDE_OPERATIVA AND CC.EQUIPO=U.EQUIPO AND NOT U.ID=CC.ID;
	</view>  
	<view>DROP VIEW IF EXISTS V_CARATULA_X_MARCO</view>
	<view>
	    CREATE VIEW V_CARATULA_X_MARCO AS 
			SELECT c.ID, m.ID_N, IFNULL(c.REG, m.COD_REGION) AS REG, IFNULL(C.NOMREG, m.REGION) AS NOMREG, 
			IFNULL(c.NOMBREDD,u.DEPARTAMENTO) AS NOMBREDD, IFNULL(c.NOMBREPP, u.PROVINCIA) AS NOMBREPP, 
			IFNULL(c.NOMBREDI,u.DISTRITO) AS NOMBREDI, IFNULL(c.CCDD,u.CCDD) CCDD, IFNULL(c.CCPP,u.CCPP) CCPP, 
			IFNULL(c.CCDI,u.CCDI) CCDI ,IFNULL(c.CCCP,m.CCCP) CCCP, IFNULL(c.NOMBRECP, m.NOMBRECP) NOMBRECP, 
			IFNULL(c.AREA,m.AREA) AREA, 
			IFNULL(c.ZONA, CASE WHEN m.ZONA IS NULL THEN NULL ELSE m.ZONA||IFNULL(m.ZONALF, '') END) ZONA, 
			IFNULL(c.MZA, CASE WHEN m.MZA IS NULL THEN NULL ELSE m.MZA||IFNULL(m.MZNALF, '') END) MZA,
			IFNULL(c.AER, CASE WHEN m.AER_INI IS NULL THEN NULL ELSE m.AER_INI||'-'||IFNULL(m.AER_FIN, '') END) AER,
			IFNULL(c.ESTADO_ENVIO, 1) ESTADO_ENVIO , c.*
			FROM T_MARCO m 
			INNER JOIN T_UBIGEO u ON u.UBIGEO = m.UBIGEO
			LEFT JOIN T_DIG_01 c ON c.ID_N = m.ID_N
	</view>
    <view>DROP VIEW IF EXISTS V_PERMISOS;</view>
	<view>
	    CREATE VIEW V_PERMISOS AS
	    SELECT DISTINCT
			p.ID, r.ID AS ROL_ID, p.DESCRIPCION
			FROM T_PERMISO p 
			JOIN T_ROLES_PERMISOS rp on rp.PERMISO_ID=p.ID  
			JOIN T_ROL r on r.ID=rp.ROL_ID
	</view>
	<!--  <view>DROP VIEW IF EXISTS V_SEDE_OPERATIVA_UBIGEO</view>
	<view>
	    CREATE VIEW V_SEDE_OPERATIVA_UBIGEO AS 
		SELECT DISTINCT su.*, s.SEDE, u.CCDD, u.CCPP, u.CCDI  
		  FROM T_SEDES_OPERATIVAS_UBIGEO su
		  JOIN T_SEDES_OPERATIVAS s ON s.COD_SEDE=su.COD_SEDE
		  JOIN T_UBIGEO u ON u.UBIGEO = su.UBIGEO;
	</view>-->
	<view>DROP VIEW IF EXISTS V_SEGMENTACION;</view>
	<view>
	    CREATE VIEW V_SEGMENTACION AS
      	SELECT 1 AS ORDEN, '-- SELECCIONE --' AS ZONA,  '000' AS MZA,
		    	   '00' AS CCDD, '00' AS CCPP, '00' AS CCDI, 0 AS PERIODO, '000' AS EQUIPO, '00' AS RUTA, NULL USUARIO_ID,
		    	   '-- SELECCIONE --' AS PERIODO_DESC, 0 AS ORDEN
			UNION ALL
			SELECT 2 AS ORDEN, NULL AS ZONA, NULL AS MZA, Seg.CCDD, Seg.CCPP, Seg.CCDI, Seg.PERIODO, Seg.EQUIPO, Seg.RUTA, NULL USUARIO_ID,
			      PERIODO||CASE PERIODO 
			         WHEN 1 THEN 'er' 
			         WHEN 2 THEN 'do'
			         WHEN 3 THEN 'er'
			         WHEN 4 THEN 'to'
         			 WHEN 5 THEN 'to'
			         WHEN 6 THEN 'to'
			         WHEN 7 THEN 'mo'
			         WHEN 8 THEN 'vo'
			         WHEN 9 THEN 'no'
			         WHEN 10 THEN 'mo'
               ELSE 'vo' END||' PERIODO' AS PERIODO_DESC, NULL ORDEN
			FROM [T_SEGMENTACION] Seg
			UNION ALL
			SELECT 3 AS ORDEN, '-- TODOS --' AS ZONA,  '000' AS MZA,
		    	   '00' AS CCDD, '00' AS CCPP, '00' AS CCDI, 99 AS PERIODO, '000' AS EQUIPO, '00' AS RUTA, NULL USUARIO_ID,
		    	   '-- TODOS --' AS PERIODO_DESC, 0 AS ORDEN 			
			ORDER BY CCDD, CCPP, CCDI, PERIODO, ORDEN;
	</view>
	<view>DROP VIEW IF EXISTS V_DICCIONARIO</view>
    <view>
          CREATE VIEW V_DICCIONARIO AS
				SELECT DISTINCT r.ID, r.RANGO, r.DESCRIPCION, c.TABLA, c.CAMPO, c.VISTA, c.ALTERNATIVA, a.ALTERNATIVA_VALOR, a.DESCRIPCION AS ALTERNATIVA_DESCRIPCION, r.INACTIVO
				  FROM T_RANGOS r
				  LEFT JOIN T_RANGO_PREGUNTA rp ON rp.RANGO_ID = r.ID
				  LEFT JOIN T_CAMPOS c ON c.TABLA = rp.TABLA AND c.CAMPO = rp.CAMPO
				  LEFT JOIN T_ALTERNATIVAS a ON a.TABLA=c.TABLA AND a.CAMPO = c.CAMPO
    </view>
    <view>DROP VIEW IF EXISTS V_NAVEGATION</view>
    <view>
          CREATE VIEW V_NAVEGATION AS
				SELECT C.ID,C.ID_N,C.II1 AS CAR, V.CAPV, D.ID_N AS CAP100, E.CAP200, 
				 C.USUCRE,C.FECCRE,C.USUREG,C.FECREG,C.FECENV FROM T_DIG_01 C
				  LEFT JOIN (SELECT ID_N, COUNT(ID_N) AS CAPV FROM T_DIG_03_VISITA GROUP BY ID_N) V ON V.ID_N = C.ID_N
				  LEFT JOIN (SELECT ID_N FROM T_DIG_03_100) D ON D.ID_N = C.ID_N
				  LEFT JOIN (SELECT ID_N, COUNT(ID_N) AS CAP200 FROM T_DIG_03_200 GROUP BY ID_N) E ON E.ID_N = C.ID_N
    </view>
    <view>DROP VIEW IF EXISTS V_MODALIDADES</view>
    <view>
          CREATE VIEW V_MODALIDADES AS
				SELECT M.CODIGO, M.NOMBRE, M.VALOR, P.NOMBRE AS TITULO, Q.NOMBRE AS SUBTITULO,
				NULL AS USUCRE,NULL AS FECCRE,NULL AS USUREG,NULL AS FECREG,NULL AS FECENV, NULL AS ID FROM T_MODALIDADES M
				LEFT JOIN (SELECT DISTINCT CODIGO, NOMBRE FROM T_MODALIDADES WHERE VALOR = 0) P ON P.CODIGO = M.TITULO
				LEFT JOIN (SELECT DISTINCT CODIGO, NOMBRE FROM T_MODALIDADES WHERE VALOR = 1) Q ON Q.CODIGO = M.SUBTITULO
    </view>
    <view>DROP VIEW IF EXISTS V_LISTAVICTIMAS</view>
    <view>
    	CREATE VIEW V_LISTAVICTIMAS	AS
				SELECT ORDEN_300 AS ID, ID_N AS CODIGO, IVH301A||' '||IVH301B||' '||IVH301C AS NOMBRE, 
				IVH302_N AS DNI, NULL AS VALOR, NULL AS TITULO, NULL AS SUBTITULO, NULL AS USUCRE,NULL AS FECCRE,NULL AS USUREG,NULL AS FECREG,NULL AS FECENV  
			FROM T_DIG_03_300
     </view>
    
</sql> 
